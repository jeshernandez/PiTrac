# PiTrac Dependency Configuration
# Format: package_name:dependencies:detection_method:install_script
#
# Dependencies are comma-separated, use SYSTEM for apt packages
# Detection methods: cmd, pkg-config, file, function, apt
# Install scripts are relative to scripts/ directory

# System packages (installed via apt)
build-essential:SYSTEM:apt:
cmake:SYSTEM:apt:
git:SYSTEM:apt:
wget:SYSTEM:apt:
curl:SYSTEM:apt:
unzip:SYSTEM:apt:
ca-certificates:SYSTEM:apt:
dialog:SYSTEM:apt:
vim:SYSTEM:apt:
python3:SYSTEM:apt:
python3-pip:SYSTEM:apt:
meson:SYSTEM:apt:
ninja-build:SYSTEM:apt:

# Java stack
java:SYSTEM:apt:openjdk-17-jdk,openjdk-17-jre
maven:java:apt:maven

# Base libraries needed by multiple components
boost:SYSTEM:apt:libboost1.81-all-dev
libssl-dev:SYSTEM:apt:
libapr1-dev:SYSTEM:apt:
libaprutil1-dev:SYSTEM:apt:
uuid-dev:SYSTEM:apt:

# Message queue stack (order matters!)
activemq-broker::function:install_mq_broker.sh
activemq-cpp:activemq-broker,libssl-dev,libapr1-dev,libaprutil1-dev,uuid-dev:function:install_activemq_cpp_cms.sh

# Serialization
msgpack:build-essential,cmake:function:install_msgpack.sh

# GPIO libraries
lgpio:build-essential:function:install_lgpio.sh

# Computer vision stack
opencv:build-essential,cmake:function:install_opencv.sh

# Camera stack (depends on opencv for some features)
libcamera:build-essential,cmake,python3,python3-pip,meson,ninja-build:function:install_libcamera.sh

# Application server
tomee:java:function:install_tomee.sh

# PiTrac specific packages
pitrac-deps:boost,cmake:apt:raspberrypi-kernel-headers,libfmt-dev

# System Configuration (Pi-specific hardware and OS setup)
system-config:SYSTEM:function:config/install_system_config.sh
camera-config:system-config,libcamera:function:config/install_camera_config.sh
pitrac-environment:camera-config:function:config/install_pitrac_environment.sh

# Network Services (NAS, Samba, SSH keys)
network-services:SYSTEM:function:config/install_network_services.sh

# Development Environment (optional productivity tools)
dev-environment:SYSTEM:function:config/install_dev_environment.sh

# Test processor for running tests without camera
test-processor:SYSTEM:apt:python3,python3-yaml,jq

# PiTrac Build (builds the actual launch monitor)
# Depends on: software packages + system config + camera config + environment setup
pitrac-build:opencv,libcamera,msgpack,lgpio,activemq-cpp,system-config,camera-config,pitrac-environment:function:build_pitrac.sh

# PiTrac Runtime (runs the launch monitor)
# Depends on: built pitrac + optional services
run-pitrac:pitrac-build:function:run_pitrac.sh